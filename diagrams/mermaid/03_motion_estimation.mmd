```mermaid
flowchart TD
    subgraph "Optical Flow Estimation"
        A[Frame t] --> B[RAFT Network]
        C[Frame t+1] --> B
        B --> D[Dense Flow Field]
    end

    subgraph "Confidence Assessment"
        D --> E[Compute Flow Magnitude]
        D --> F[Compute Flow Consistency]
        E --> G{Mean Confidence > τ}
        F --> G
    end

    subgraph "Primary Path: RAFT"
        G -->|High Confidence| H[Extract Keypoint Correspondences]
        H --> I[RANSAC Outlier Rejection]
        I --> J[Fit Similarity Transform]
    end

    subgraph "Fallback Path: ECC"
        G -->|Low Confidence| K[Convert to Grayscale]
        K --> L[ECC Template Matching]
        L --> M[Iterative Refinement]
        M --> N[Euclidean Transform]
        N --> J
    end

    subgraph "Transform Parameters"
        J --> O["4-DoF Transform:<br/>• Translation (tx, ty)<br/>• Rotation (θ)<br/>• Scale (s)"]
    end

    style B fill:#fff3e0
    style L fill:#e8f5e9
    style O fill:#e1f5fe

    note1["RAFT achieves 30-40%<br/>lower error than<br/>traditional methods"]
    style note1 fill:#f5f5f5,stroke:#9e9e9e
```
